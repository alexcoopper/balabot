import { User } from 'telegraf/typings/core/types/typegram';
import { AiServiceApi } from './AiServiceApi';
import { UserInfo } from './UserInfoService';
import { SimpleWeather, WeatherData } from './WeatherService';

export class AiService {
    private aiServiceApi: AiServiceApi;

    constructor() {
        this.aiServiceApi = new AiServiceApi();
    }

    async generateDailyMessage(): Promise<string> {
        const prompt = `–¢–≤–æ—è —Ä–æ–ª—å - —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç —á–∞—Ç. –ß–æ–ª–æ–≤—ñ—á–∞ —Å—Ç–∞—Ç—å. –¢–∏ –º–∞—î—à –ø—Ä–∏—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ –∫–æ–∂–µ–Ω –¥–µ–Ω—å —É –≥—Ä—É–ø–æ–≤–∏–π —á–∞—Ç —Ç–µ–ª–µ–≥—Ä–∞–º. 
        –©–æ—Å—å —Ç–∏–ø—É "–∞ —è —â–µ —Ç—É—Ç, –Ω–µ –∑–∞–±—É–≤–∞–π—Ç–µ –ø—Ä–æ –º–µ–Ω–µ.". –£ —á–∞—Ç—ñ —î —è–∫ —Ö–ª–æ–ø—Ü—ñ, —Ç–∞–∫ —ñ –¥—ñ–≤—á–∞—Ç–∞.
        –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º–∞—î –±—É—Ç–∏ 18+, –∑ –ø–æ—à–ª—ñ—Å—Ç—é, –Ω–∞—Ö–∞–±—Å—Ç–≤–æ–º —ñ –≥—É–º–æ—Ä–æ–º. –ú–∞—î –±—É—Ç–∏ –¥—É–∂–µ –∂–æ—Ä—Å—Ç–∫–∏–π –≥—É–º–æ—Ä!. –í—ñ–Ω –º–∞—î –±—É—Ç–∏ –Ω–µ –¥–µ–≤—à–µ –Ω—ñ–∂ 1 —Ä–µ—á–µ–Ω–Ω—è! –ë–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —á–∏ –ø–æ—è—Å–Ω–µ–Ω—å.`;
        return await this.aiServiceApi.generateResponse(prompt);
    }

    async generateDailyWeatherMessage(weather: SimpleWeather): Promise<string> {
        const prompt = `–¢–≤–æ—è —Ä–æ–ª—å - —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç —á–∞—Ç. –ß–æ–ª–æ–≤—ñ—á–∞ —Å—Ç–∞—Ç—å. –¢–∏ –º–∞—î—à –ø—Ä–∏—Å–ª–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞ –∫–æ–∂–µ–Ω –¥–µ–Ω—å —É –≥—Ä—É–ø–æ–≤–∏–π —á–∞—Ç —Ç–µ–ª–µ–≥—Ä–∞–º. 
        –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –¥–∞–Ω—ñ –ø—Ä–æ –ø–æ–≥–æ–¥—É: ${JSON.stringify(weather)}.
        –í –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ —Ç—Ä–µ–±–∞ —Å–∫–∞–∑–∞—Ç–∏ —è–∫–∞ –Ω–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –±—É–¥–µ –ø–æ–≥–æ–¥–∞, —â–æ –≤–∞—Ä—Ç–æ –º–∞—Ç–∏ –Ω–∞ —É–≤–∞–∑—ñ, —è–∫—ñ —Ä–µ—á—ñ –≤–∑—è—Ç–∏ –∑ —Å–æ–±–æ—é, —â–æ–± –Ω–µ –∑–∞–º–µ—Ä–∑–Ω—É—Ç–∏ –∞–±–æ –Ω–µ –∑–≥–æ—Ä—ñ—Ç–∏ –Ω–∞ —Å–æ–Ω—Ü—ñ.
        –û–±–æ–≤'–∑—è–∫–æ–≤–æ –≤–∫–∞–∂—É —è–∫–∞ –æ—á—ñ–∫—É—î—Ç—å—Å—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ñ–¥ —ñ –¥–æ.
        –£ —á–∞—Ç—ñ —î —è–∫ —Ö–ª–æ–ø—Ü—ñ, —Ç–∞–∫ —ñ –¥—ñ–≤—á–∞—Ç–∞.
        –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º–∞—î –±—É—Ç–∏ 18+, –∑ –ø–æ—à–ª—ñ—Å—Ç—é, –Ω–∞—Ö–∞–±—Å—Ç–≤–æ–º —ñ –≥—É–º–æ—Ä–æ–º!. –í—ñ–Ω –º–∞—î –±—É—Ç–∏ –Ω–µ –¥–µ–≤—à–µ –Ω—ñ–∂ 1 —Ä–µ—á–µ–Ω–Ω—è! –ë–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —á–∏ –ø–æ—è—Å–Ω–µ–Ω—å. 
        –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –µ–º–æ–¥–∂—ñ.`;
        return await this.aiServiceApi.generateResponse(prompt);
    }

    //async generateDailyJoke(): Promise<string> {
    //    const prompt = `–¢–≤–æ—è —Ä–æ–ª—å - –ø—Ä–∏—Å–ª–∞—Ç–∏ –∞–Ω–µ–≥–¥–æ—Ç. –í—ñ–Ω –º–∞—î –±—É—Ç–∏ 18+. –î—É–∂–µ —Å–º—ñ—à–Ω–∏–π!
    //    –õ–∏—à–µ –æ–¥–∏–Ω! –í—ñ–Ω –º–∞—î –±—É—Ç–∏ –Ω–µ –¥–µ–≤—à–µ –Ω—ñ–∂ 4 —Ä–µ—á–µ–Ω–Ω—è! –ù–∞–¥—Å–∏–ª–∞–π –ª–∏—à–µ —Å–∞–º –∞–Ω–µ–≥–¥–æ—Ç, –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —á–∏ –ø–æ—è—Å–Ω–µ–Ω—å.`;
    //    return await this.aiServiceApi.generateResponse(prompt);
    //}

    

    async generateTrashMessage(): Promise<string> {
        const prompt = `–ó–≥–µ–Ω–µ—Ä—É–π –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫–µ –Ω–∞–≥–∞–¥—É—î –≤–∏–∫–∏–Ω—É—Ç–∏ —Å–º—ñ—Ç—Ç—è —Ç–∞ –≤–∏–∫–æ—Ç–∏—Ç–∏ –±–∞–∫–∏. 
        –¶–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –∫–æ–∂–µ–Ω –≤–µ—á—ñ—Ä –≤—ñ–≤—Ç–æ—Ä–∫–∞.  
        –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º–∞—î –±—É—Ç–∏ 18+, –∑ –ø–æ—à–ª—ñ—Å—Ç—é, –Ω–∞—Ö–∞–±—Å—Ç–≤–æ–º —ñ –≥—É–º–æ—Ä–æ–º.
        –ù–µ –±—ñ–ª—å—à–µ 4 —Ä–µ—á–µ–Ω—å! –ó–≤–µ—Ä—Ç–∞–π—Å—è –¥–æ –∫—ñ–ª—å–∫–æ—Ö –ª—é–¥–µ–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–Ω–æ–∂–∏–Ω—É: "–í–∏", "–í–∞—à", "–í–∞–º".`;
        return await this.aiServiceApi.generateResponse(prompt);
    }

    getCommonPartForRandomMessage(userInfo: UserInfo|undefined): string {
        const userDetails = userInfo ? `–Ü–º'—è –∞–≤—Ç–æ—Ä–∞: ${userInfo.name}, –°—Ç–∞—Ç—å –∞–≤—Ç–æ—Ä–∞: ${userInfo.sex}` : '–ù–µ –∑–≥–∞–¥—É–π —Å—Ç–∞—Ç—å —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.';
        return `
            –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º–∞—î –±—É—Ç–∏ 18+, –∑ –ø–æ—à–ª—ñ—Å—Ç—é, –Ω–∞—Ö–∞–±—Å—Ç–≤–æ–º —ñ –≥—É–º–æ—Ä–æ–º.
            ${this.getHumorStyle()}
            –ù–µ –±—ñ–ª—å—à–µ 1 —Ä–µ—á–µ–Ω–Ω—è! 
            –ó–≤–µ—Ä—Ç–∞–π—Å—è –Ω–∞ —Ç–∏, –¥–æ —Ç–æ–≥–æ —Ö—Ç–æ —Ü–µ –Ω–∞–ø–∏—Å–∞–≤. 
            –£ —á–∞—Ç—ñ —î —è–∫ —Ö–ª–æ–ø—Ü—ñ, —Ç–∞–∫ —ñ –¥—ñ–≤—á–∞—Ç–∞. 
            –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤–∞—É–π –µ–º–æ–¥–∂—ñ —É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.
            ${userDetails}`;
    } 

    async generateHealtyMessage(): Promise<string> {
        const prompt = `–¢–≤–æ—è —Ä–æ–ª—å ‚Äî –ø–æ–º—ñ—á–Ω–∏–∫ –¥–ª—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Å–ø–æ—Å–æ–±—É –∂–∏—Ç—Ç—è. –¢–∏ –ø–∏—à–µ—à –º–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω—ñ —Ç–∞ –∫–æ—Ä–∏—Å–Ω—ñ –ø–æ—Ä–∞–¥–∏ —É –¥—Ä—É–∂–Ω—å–æ–º—É —ñ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–º—É —Å—Ç–∏–ª—ñ. 
–ü–æ—Ä–∞–¥–∞ –±—É–¥–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–∞ —É –≥—Ä—É–ø–æ–≤–∏–π —á–∞—Ç –≤ —Å–µ—Ä–µ–¥–∏–Ω—ñ –¥–Ω—è.
–ó–≥–µ–Ω–µ—Ä—É–π –∫–æ—Ä–æ—Ç–∫–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫–µ –º–æ—Ç–∏–≤—É—î –ª—é–¥–∏–Ω—É –≤–∏–∫–æ–Ω–∞—Ç–∏ –Ω–µ–≤–µ–ª–∏–∫—É —Ñ—ñ–∑–∏—á–Ω—É –≤–ø—Ä–∞–≤—É –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ —â–æ—Å—å –∫–æ—Ä–∏—Å–Ω–µ –¥–ª—è –∑–¥–æ—Ä–æ–≤'—è. 

–ü—Ä–∏–∫–ª–∞–¥–∏ –ø–æ—Ä–∞–¥:
1. "–î–∞–≤–∞–π, –Ω–µ –ª—ñ–Ω—É–π—Å—è! –ü–æ—Å—Ç–∞–≤ —Ç–∞–π–º–µ—Ä –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω —ñ –∑—Ä–æ–±–∏ –ª–µ–≥–∫—É —Ä–æ–∑–º–∏–Ω–∫—É: –ø–æ–≤–æ—Ä–æ—Ç–∏ –≥–æ–ª–æ–≤–∏, –Ω–∞—Ö–∏–ª–∏, –º–∞—Ö–∏ —Ä—É–∫–∞–º–∏."
2. "–í–∏–ø–∏–π —Å–∫–ª—è–Ω–∫—É –≤–æ–¥–∏, —Ç–≤—ñ–π –æ—Ä–≥–∞–Ω—ñ–∑–º —Å–∫–∞–∂–µ —Ç–æ–±—ñ —Å–ø–∞—Å–∏–±—ñ! üíß"
3. "–ü–æ—Ä–∞ –ø—ñ–¥–∑–∞—Ä—è–¥–∏—Ç–∏ —Ç—ñ–ª–æ: –∑—Ä–æ–±–∏ 10 –ø—Ä–∏—Å—ñ–¥–∞–Ω—å –ø—Ä—è–º–æ –∑–∞—Ä–∞–∑! –¢–∏ –∑–º–æ–∂–µ—à!"

–°—Ç–∏–ª—å: –¥—Ä—É–∂–Ω—ñ–π, –º–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω–∏–π, –∑ –≥—É–º–æ—Ä–æ–º –∞–±–æ –µ–º–æ–¥–∂—ñ. 
–î–æ–≤–∂–∏–Ω–∞: 1-2 —Ä–µ—á–µ–Ω–Ω—è. 
–ú–µ—Ç–∞: —Å–ø–æ–Ω—É–∫–∞—Ç–∏ –ª—é–¥–∏–Ω—É –¥—ñ—è—Ç–∏. 
–ó–≤–µ—Ä—Ç–∞–π—Å—è –¥–æ –∫—ñ–ª—å–∫–æ—Ö –ª—é–¥–µ–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –º–Ω–æ–∂–∏–Ω—É: "–í–∏", "–í–∞—à", "–í–∞–º".

–í–∏–ø–∞–¥–∫–æ–≤–∞ –ø–æ—Ä–∞–¥–∞:`;
        return await this.aiServiceApi.generateResponse(prompt);
    }

    async generateRandomMessage(messageText: string, userInfo: UserInfo|undefined): Promise<string> {
        const prompt = `–¢–≤–æ—è —Ä–æ–ª—å - —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç —á–∞—Ç. –ß–æ–ª–æ–≤—ñ—á–∞ —Å—Ç–∞—Ç—å. 
        –ó–≥–µ–Ω–µ—Ä—É–π –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫–µ —è–∫–æ—Å—å –ø–æ–≤'—è–∑–∞–Ω–æ –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º –≤ –≥—Ä—É–ø–æ–≤–æ–º—É —á–∞—Ç—ñ.
        –ü–æ–ø–µ—Ä–µ–¥–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: ${messageText}.
        ${this.getCommonPartForRandomMessage(userInfo)}`;
        return await this.aiServiceApi.generateResponse(prompt);
    }

    async generateAnswerToDirectMessage(messageText: string, userInfo: UserInfo|undefined): Promise<string> {
        const prompt = `–¢–≤–æ—è —Ä–æ–ª—å - —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç —á–∞—Ç. –ß–æ–ª–æ–≤—ñ—á–∞ —Å—Ç–∞—Ç—å. 
        –¢–∏ –º–∞—î—à –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫–µ –±—É–ª–µ –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–æ –Ω–∞–ø—Ä—è–º—É —Ç–æ–±—ñ.
        –¢–æ–±—ñ –Ω–∞–ø–∏—Å–∞–ª–∏: ${messageText}.
        ${this.getCommonPartForRandomMessage(userInfo)}`;
        return await this.aiServiceApi.generateResponse(prompt);
    }

    async generateAnswerToReplayMessage(messageText: string, replayToText: string, userInfo: UserInfo|undefined): Promise<string> {
        const prompt = `–¢–≤–æ—è —Ä–æ–ª—å - —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç —á–∞—Ç. –ß–æ–ª–æ–≤—ñ—á–∞ —Å—Ç–∞—Ç—å. 
        –¢–æ–±—ñ –≤—ñ–¥–ø–æ–≤—ñ–ª–∏ –Ω–∞ –æ–¥–Ω–µ –∑ —Ç–≤–æ—ó—Ö –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å.
        –¢–æ–±—ñ –Ω–∞–ø–∏—Å–∞–ª–∏: ${messageText}. –¢–≤–æ—î –ø–æ–ø–µ—Ä–µ–¥–Ω—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: ${replayToText}.
        –î–∞–π –Ω–∞—Å—Ç—É–ø–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –±–µ—Ä—É—á–∏ –¥–æ —É–≤–∞–≥–∏ –≤–µ—Å—å –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.
        ${this.getCommonPartForRandomMessage(userInfo)}`;
        return await this.aiServiceApi.generateResponse(prompt);
    }

    getHumorStyle(): string {
        const humorStyles = [
            '—Å–∞—Ä–∫–∞–∑–º',
            '—ñ—Ä–æ–Ω—ñ—è',
            '–≥—Ä—É–±–∏–π –≥—É–º–æ—Ä',
            '–≥—Ä–∞ —Å–ª—ñ–≤',
            '–∞–±—Å—É—Ä–¥–Ω–∏–π –≥—É–º–æ—Ä'
        ];
        const selectedStyle = humorStyles[Math.floor(Math.random() * humorStyles.length)];
        return `–°—Ç–∏–ª—å –≥—É–º–æ—Ä—É: ${selectedStyle}, —Ü—É –¥—É–∂–µ –≤–∞–∂–ª–∏–≤–æ.`;
    }
}
